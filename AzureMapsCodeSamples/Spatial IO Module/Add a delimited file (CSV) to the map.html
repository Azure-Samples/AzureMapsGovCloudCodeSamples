<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add a delimited file (CSV) to the map - Azure Maps Web SDK Samples</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="This sample shows how to add a delimited file (CSV, TSV, PIPE) to the map by converting it into GeoJSON." />
    <meta name="keywords" content="Microsoft maps, map, gis, API, SDK, CSV, TSV, delimited file" />
    <meta name="author" content="Microsoft Azure Maps" />

    <!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>

    <!-- Add reference to the Azure Maps Spatial IO module. -->
    <script src="https://atlas.microsoft.com/sdk/javascript/spatial/0/atlas-spatial.min.js"></script>

    <script type='text/javascript'>
        var map, datasource, layer;

        var delimitedFileUrl = '../Common/data/spatialcsv/Chicago_Narcotics.csv';
        
        function GetMap() {
            //Point the Azure Maps domain to the US Azure Gov Cloud domain.
            atlas.setDomain('atlas.azure.us');

            //Initialize a map instance.
            map = new atlas.Map('myMap', {
                view: 'Auto',

                //Add your Azure Maps subscription key to the map SDK. Get an Azure Maps key at https://azure.com/maps
                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: '<Your Azure Maps Key>'
                }
            });

            //Wait until the map resources are ready.
            map.events.add('ready', function () {

                //Create a data source and add it to the map.
                datasource = new atlas.source.DataSource();
                map.sources.add(datasource);

                //Add a simple data layer for rendering the data.
                layer = new atlas.layer.SimpleDataLayer(datasource);
                map.layers.add(layer);

                //Read a CSV file from a URL or pass in a raw string.
                atlas.io.read(delimitedFileUrl).then(r => {
                    if (r) {
                        //Add the feature data to the data source.
                        datasource.add(r);

                        //If bounding box information is known for data, set the map view to it.
                        if (r.bbox) {
                            map.setCamera({ bounds: r.bbox, padding: 50 });
                        }
                    }
                });
            });
        }
    </script>
</head>
<body onload="GetMap()">
    <div id="myMap" style="position:relative;width:100%;min-width:290px;height:600px;"></div>

    <fieldset style="width:calc(100% - 30px);min-width:290px;margin-top:10px;">
        <legend><h1 style="font-size:16px">Add a delimited file (CSV) to the map</h1></legend>
        This sample shows how to add a delimited file (CSV, TSV, PIPE) to the map by converting it into GeoJSON.
        The spatial io module analyizes the data and looks for common column names used to store latitude and longitude values. If no suitable column if found it then analyizes the data in the first row to seeif any column contains any strings in well known text (WKT) format. 
    </fieldset>
</body>
</html>